<html>

<head>
    <script src="https://gve.wl.group.video/v1/lib.js"></script>
</head>

<body>
    <iframe id="iframe" allow="microphone;camera" src="index.html?name=mehrdad&room=test1"
        style="width: 100%;height: 100%;"></iframe>
    <div>
        <button id="audio-btn" onclick="audioClick(this)">Toggle Audio</button>
        <button id="video-btn" onclick="videoClick(this)">Toggle Video</button>
        <button id="sc-btn" onclick="scClick(this)">Toggle Screenshare</button>
        <button
            onclick="gv.getAudioVideoStatus().then(res => {alert(JSON.stringify(res));});">getAudioVideoStatus</button>
        <button
            onclick="gv.getScreenShareStatus().then(res => {alert(JSON.stringify(res));});">getScreenShareStatus</button>
    </div>
    <script>
        const gv = new window.GroupVideo(document.getElementById("iframe"));
        console.log(GroupVideo.CALL_STATUS_UPDATED);
        gv.addEventListener(GroupVideo.MY_AUDIO_MUTED, (data) => {
            console.log('MY_AUDIO_MUTED updated', data);
        });
        gv.addEventListener(GroupVideo.MY_AUDIO_UNMUTED, (data) => {
            console.log('MY_AUDIO_UNMUTED updated', data);
        });
        gv.addEventListener(GroupVideo.MY_VIDEO_HIDDEN, (data) => {
            console.log('MY_VIDEO_HIDDEN updated', data);
        });
        gv.addEventListener(GroupVideo.MY_VIDEO_UNHIDDEN, (data) => {
            console.log('MY_VIDEO_UNHIDDEN updated', data);
        });
        gv.addEventListener(GroupVideo.CALL_STATUS_UPDATED, (data) => {
            console.log('CALL_STATUS_UPDATED updated', data);
        });
        // const onMessage = async ({ data }) => {
        //     console.log("Parent Received message: ", data);
        //     try {
        //         const msg = JSON.parse(data);
        //         if (msg.type === 'CALL_STATUS_UPDATED') {
        //             if (msg.data.isMyAudioMuted) {
        //                 document.getElementById("audio-btn").innerText = "unmuteMyAudio";
        //             } else {
        //                 document.getElementById("audio-btn").innerText = "muteMyAudio";
        //             }
        //             if (msg.data.isMyVideoHidden) {
        //                 document.getElementById("video-btn").innerText = "unhideMyVideo";
        //             } else {
        //                 document.getElementById("video-btn").innerText = "hideMyVideo";
        //             }
        //             if (msg.data.screenShareState === 'MY_SCREENSHARE_ACTIVATED') {
        //                 document.getElementById("sc-btn").innerText = "deactivateMyScreenshare";
        //             } else {
        //                 document.getElementById("sc-btn").innerText = "activateMyScreenshare";
        //             }
        //         }
        //     } catch(e) {
        //         console.log(e);
        //     }
        // };
        // window.addEventListener("message", onMessage);
        function audioClick(dobj) {
            if (gv.callStatus.isMyAudioMuted) {
                gv.unmuteMyAudio();
            } else {
                gv.muteMyAudio();
            }
        }
        function videoClick(dobj) {
            if (gv.callStatus.isMyVideoHidden) {
                gv.unhideMyVideo();
            } else {
                gv.hideMyVideo();
            }
        }
        function scClick(dobj) {
            if (dobj.innerText === 'activateMyScreenshare') {
                gv.activateMyScreenshare();
            } else {
                gv.deactivateMyScreenshare();
            }
        }
    </script>
</body>

</html>