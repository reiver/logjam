<!DOCTYPE html>

<head>
    <title>SparkScience Broadcast Sample</title>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="./js/spark-rtc.js"></script>
</head>

<body>
    <label for="myName">Name:</label>
    <input id="myName" type="text" placeholder="Enter your name" />
    <button id="signalConnectBtn" onclick="setupSignalingSocket()">Connect to Signaling Server</button>
    <button onclick="startReadingBroadcast()">Start Receiving Broadcast</button>
    <h1>Remote Stream</h1>
    <p>
        <video id="remoteVideo" playsinline muted style="width: 100%" autoplay></video>
    </p>

    <script>
        const sparkRTC = new SparkRTC('audience', null, (stream) => {
            if (document.getElementById('remoteVideo').srcObject !== stream)
                document.getElementById('remoteVideo').srcObject = stream;
        });
        const setupSignalingSocket = () => {
            const baseUrl = window.location.href.split("//")[1].split("/")[0];
            let protocol = "wss";
            if (window.location.href.split("//")[0] == "http:") {
                protocol = "ws";
            }
            return sparkRTC.setupSignalingSocket(`${protocol}://${baseUrl}/ws`, document.getElementById("myName").value);
        };
        const startReadingBroadcast = () => {
            return sparkRTC.start();
        };
    </script>
</body>

</html>